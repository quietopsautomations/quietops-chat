<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mehrops Support</title>

<style>
  body {
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0b0f1a;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }

  .chat-box {
    width: 360px;
    height: 540px;
    background: #ffffff;
    border-radius: 18px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.35);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-header {
    padding: 14px;
    background: linear-gradient(135deg, #5b7cfa, #8fa3ff);
    color: #ffffff;
    text-align: center;
    font-weight: 700;
    font-size: 15px;
  }

  .chat-messages {
    flex: 1;
    padding: 14px;
    overflow-y: auto;
    background: #f9fafb;
    font-size: 14px;
  }

  .message {
    margin-bottom: 10px;
    max-width: 85%;
    line-height: 1.4;
  }

  .bot {
    background: #ffffff;
    color: #111827;
    padding: 10px 14px;
    border-radius: 14px 14px 14px 4px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  }

  .user {
    background: #2563eb;
    color: #ffffff;
    padding: 10px 14px;
    border-radius: 14px 14px 4px 14px;
    margin-left: auto;
    text-align: right;
  }

  .buttons {
    margin-top: 6px;
  }

  .buttons button,
  .buttons a {
    display: inline-block;
    margin: 6px 6px 0 0;
    padding: 8px 14px;
    font-size: 13px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    text-decoration: none;
    font-weight: 600;
  }

  .buttons button {
    background: #e5e7eb;
    color: #111827;
  }

  .buttons a {
    background: #2563eb;
    color: #ffffff;
  }

  .chat-input {
    display: flex;
    border-top: 1px solid #e5e7eb;
    background: #ffffff;
  }

  .chat-input input {
    flex: 1;
    padding: 12px;
    border: none;
    outline: none;
    font-size: 14px;
  }

  .chat-input button {
    padding: 12px 16px;
    background: #2563eb;
    color: #ffffff;
    border: none;
    cursor: pointer;
    font-weight: 600;
  }
</style>

</head>

<body>

<div class="chat-box">
  <div class="chat-header">Mehrops Assistant</div>

  <div class="chat-messages" id="messages"></div>

  <div class="chat-input">
    <input id="input" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  const webhookUrl = "https://argcheeneh.app.n8n.cloud/webhook/quietops-chat";

  let conversationState = "start";
  let leadName = "";

  function addMessage(text, sender) {
    const div = document.createElement("div");
    div.className = "message " + sender;
    div.textContent = text;
    document.getElementById("messages").appendChild(div);
    div.scrollIntoView({ behavior: "smooth" });
  }

  function addButtons(buttons) {
    const container = document.createElement("div");
    container.className = "buttons";

    buttons.forEach(btn => {

      // ✅ URL BUTTON (opens link)
      if (btn.url) {
        const a = document.createElement("a");
        a.href = btn.url;
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.textContent = btn.label;
        container.appendChild(a);
        return;
      }

      // ✅ NORMAL CHAT BUTTON
      if (btn.value) {
        const b = document.createElement("button");
        b.textContent = btn.label;
        b.onclick = () => sendMessage(btn.value);
        container.appendChild(b);
      }
    });

    document.getElementById("messages").appendChild(container);
    container.scrollIntoView({ behavior: "smooth" });
  }

  async function sendMessage(text) {
    const input = document.getElementById("input");
    const message = text || input.value;
    if (!message) return;

    addMessage(message, "user");
    input.value = "";

    try {
      const res = await fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message,
          state: conversationState,
          name: leadName
        })
      });

      const data = await res.json();

      if (data.state) {
        conversationState = data.state;
      }

      if (data.reply) {
        addMessage(data.reply, "bot");
      }

      if (data.buttons) {
        addButtons(data.buttons);
      }

    } catch (err) {
      addMessage("Sorry — something went wrong. Please try again.", "bot");
      console.error(err);
    }
  }

  // Auto start conversation
  window.onload = () => {
    sendMessage("hello");
  };
</script>

</body>
</html>


